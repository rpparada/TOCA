{% extends 'base.html' %}
{% load static %}
{% load humanize %}
{% block title %} | HOME{% endblock %}
{% block content %}

{% include 'partials/_alerts.html' %}

{% if resultado %}
<!-- Shop products -->
<section>
    <div class="container">
      <form id="ordenfiltro" action="{% url 'busqueda' %}" method="POST">
        {% csrf_token %}
        <div class="row m-b-20">
            <input hidden name="q2" type="text" value="{{ valores }}"/>
            <div class="col-lg-5 p-t-10 m-b-20">
                <h3 class="m-b-20">Resultado busqueda: "{{ valores }}"</h3>
            </div>
            <div class="col-lg-3">
                <div class="order-select">
                    <h6>Ordenar por:</h6>
                        <select class="form-control" name="orden" onchange="changeorden()">
                            <option value="fecha" {% if orden == 'fecha' %} selected="selected" {% endif %}>Fecha Evento</option>
                            <option value="costo" {% if orden == 'costo' %} selected="selected" {% endif %}>Precio</option>
                            <option value="nombre" {% if orden == 'nombre' %} selected="selected" {% endif %}>Nombre Tocarta</option>
                            <option value="artista__nombre" {% if orden == 'artista__nombre' %} selected="selected" {% endif %}>Nombre Artista</option>
                        </select>
                </div>
            </div>
            <div class="col-lg-1">
                <div class="order-select">
                    <h6> -- ↑ ↓ -- </h6>
                        <select class="form-control" name="direccion" onchange="changefiltro()">
                            <option value="asc" {% if direccion == 'asc' %} selected="selected" {% endif %}>ASC</option>
                            <option value="des" {% if direccion == 'des' %} selected="selected" {% endif %}>DES</option>
                        </select>
                </div>
            </div>
            <div class="col-lg-2">
                <div class="order-select">
                    <h6>Filtrar por:</h6>
                        <select class="form-control" name="filtro" onchange="changefiltro()">
                            <option value="todas" {% if filtro == 'todas' %} selected="selected" {% endif %}>Todas</option>
                            <option value="cerradas" {% if filtro == 'cerradas' %} selected="selected" {% endif %}>Con lugar definido</option>
                            <option value="abiertas" {% if filtro == 'abiertas' %} selected="selected" {% endif %}>Buscando donde tocar</option>
                            <option value="artistas" {% if filtro == 'artistas' %} selected="selected" {% endif %}>Artistas</option>
                        </select>
                </div>
            </div>
            <div class="row">
                <div class="col-lg-1">
                  <h6> <br> </h6>
                  <button type="submit" class="btn btn-sm">Aplica</button>
                </div>
            </div>
          </div>
        </form>

        <!--Product list-->
        <div class="shop">
            <div class="grid-layout grid-3-columns" data-item="grid-item">
              {% for item in resultado %}
                {% if item.tipo == 'cerrada' %}
                <div class="grid-item">
                    <div class="product">
                        <div class="product-image">
                            <a href="{% url 'tocata' item.id %}"><img alt="Shop product image!" src="{{ item.flayer_380_507.url }}">
                            </a>
                            {% if item.nuevo == 'SI' %}
                            <span class="product-new">NUEVA</span>
                            {% endif %}
                        </div>
                        <div class="product-description">
                            <div class="product-category">{{ item.artista.nombre }}, {{ item.region }}, {{ item.comuna }}</div>
                            <div class="product-title">
                                <h3><a href="{% url 'tocata' item.id %}">{{ item.nombre|truncatechars:20 }}</a></h3>
                            </div>
                            <div class="product-price"><ins>$ {{ item.costo|intcomma }}</ins>
                            </div>
                            <div class="product-reviews">Cuando: {{ item.fecha }} {{ item.hora }}
                            </div>
                        </div>
                    </div>
                </div>
                {% elif item.tipo == 'abierta' %}
                <div class="grid-item">
                    <div class="product">
                        <div class="product-image">
                            <a href="{% url 'tocataabierta' item.id %}"><img alt="Shop product image!" src="{{ item.flayer_380_507.url }}">
                            </a>
                            {% if item.nuevo == 'SI' %}
                            <span class="product-new">NUEVA</span>
                            {% endif %}
                            <span class="product-sale-off">BUSCANDO</span>
                        </div>
                        <div class="product-description">
                            <div class="product-category">{{ item.artista.nombre }}, {{ item.region }}, {{ item.comuna }}</div>
                            <div class="product-title">
                                <h3><a href="{% url 'tocataabierta' item.id %}">{{ item.nombre|truncatechars:20 }}</a></h3>
                            </div>
                            <div class="product-reviews">Cuando: {{ item.fecha }} {{ item.hora }}
                            </div>
                        </div>
                    </div>
                </div>
                {% elif item.tipo == 'artista' %}
                <div class="grid-item">
                  <div class="team-member">
                      <div class="team-image">
                          <img src="{{ item.foto_525_350.url }}">
                      </div>
                      <div class="team-desc">
                          <h3><a href="{% url 'artista' item.id %}">{{ item.nombre }}</a></h3>
                          <span>{{ item.habilidades }}</span>
                          <p>{{ item.descripción|truncatechars:150 }}</p>
                          <div class="align-center">
                              {% if item.link_facebook %}
                              <a class="btn btn-xs btn-slide btn-light" href="{{ item.link_facebook }}">
                                  <i class="fab fa-facebook-f"></i>
                                  <span>Facebook</span></a>
                              {% endif %}
                              {% if item.link_twitter %}
                              <a class="btn btn-xs btn-slide btn-light" href="{{ item.link_twitter }}" data-width="100">
                                  <i class="fab fa-twitter"></i>
                                  <span>Twitter</span></a>
                              {% endif %}
                              {% if item.link_instagram %}
                              <a class="btn btn-xs btn-slide btn-light" href="{{ item.link_instagram }}" data-width="118">
                                  <i class="fab fa-instagram"></i>
                                  <span>Instagram</span></a>
                              {% endif %}
                          </div>
                      </div>
                  </div>

                </div>
                {% endif %}
              {% endfor %}
            </div>

            <!-- Pagination -->
            {% if resultado.has_other_pages %}
            <ul class="pagination">
              {% if resultado.has_previous %}
                <li class="page-item"><a class="page-link" href="?page={{ resultado.previous_page_number }}">Previous</a></li>
              {% else %}
                <li class="page-item disabled"><a class="page-link">Previous</a></li>
              {% endif %}

              {% for i in resultado.paginator.page_range %}
                {% if resultado.number == i %}
                  <li class="page-item active"><a class="page-link">{{i}}</a></li>
                {% else %}
                  <li class="page-item"><a class="page-link" href="?page={{ i }}">{{i}}</a></li>
                {% endif %}
              {% endfor %}

              {% if resultado.has_next %}
                <li class="page-item"><a class="page-link" href="?page={{ resultado.next_page_number }}">Next</a></li>
              {% else %}
                <li class="page-item disabled"><a class="page-link">Next</a></li>
              {% endif %}
            </ul>
            {% endif %}
            <!-- end: Pagination -->
        </div>
        <!--End: Product list-->
    </div>
</section>
<!-- end: Shop products -->
{% endif %}
<section>
    <div class="container">
        <div class="row m-b-20">
            <div class="col-lg-12 p-t-10 m-b-20">
                <h3 class="m-b-20">No encontramos nada de: "{{ valores }}"</h3>
            </div>
        </div>
    </div>
</section>
{% endblock %}
